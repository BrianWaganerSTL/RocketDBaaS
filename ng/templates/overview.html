{% extends "master_template.html" %}

{% load static %}
{% load humanize %}
{% load i18n %}

{% block title %}Rocket DBaaS{% endblock %}

{% block main_content %}
    <table class="table table-hover" style="background-color: #eaf8ff">
        <thead>
        <tr style="background-color: #79aec8">
            <th scope="col">Cluster</th>
            <th scope="col">DBMS</th>
            <th scope="col">Application</th>
            <th scope="col">Nodes</th>
            <th scope="col">CPU (GB)</th>
            <th scope="col">RAM (GB)</th>
            <th scope="col">DB GB</th>
            <th scope="col">Health</th>
        </tr>
        </thead>
        <tbody>
        {% for c in clusters %}
            <tr>
                    <th>
                        <button href="#{{ c.cluster_name }}" class="btn btn-info btn-sm" data-toggle="collapse">+</button>
                        <a href="{% url 'cluster_details' c.id %}">{{ c.cluster_name }}</a>
                    </th>
                <td>{{ c.dbms_type }}</td>
                <td>{{ c.application }}</td>
                <td>{{ c.server_set.all|length }}</td>
                {# https://stackoverflow.com/questions/44773579/django-template-nested-for-loop#}
                <td>{{ c.requested_cpu }}</td>
                <td>{{ c.requested_mem_gb }}</td>
                <td>{{ c.requested_db_gb|intcomma }}</td>
                <td>{{ c.cluster_health }}</td>
            </tr>
            {% for s in c.server_set.all %}
                <tr id="{{ c.cluster_name }}" style="height: 30px" class="collapse in">
                    {% if s.node_role == 'Primary' %}
                        <td style="font-size: .8rem; padding:.25rem; text-align:right" >
                            <img class="img-responsive" src="{% static 'icons/primary.jpg' %}" height="20px"></td>
                    {% else %}
                        <td style="font-size: .8rem; padding:.25rem; text-align:right" >
                            <img class="img-responsive" src="{% static 'icons/secondary.jpg' %}" height="20px"></td>
                    {% endif %}
                    <td style="font-size: .8rem; padding:.25rem">{{ s.data_center }} : {{ s.server_name }}</td>
                </tr>
            {% endfor %}
        {% endfor %}
        </tbody>
    </table>
{%  endblock %}
